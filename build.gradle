plugins
{
	id 'java'
	id 'application'
}

// Java configuration.
java
{
	sourceCompatibility = JavaVersion.VERSION_25
	targetCompatibility = JavaVersion.VERSION_25
}

// Entry point.
application
{
	mainClass = 'simplecraft.SimpleCraft'
}

repositories
{
	mavenCentral()
}

// JMonkeyEngine version â€” 3.8.0 is the latest stable.
def jmeVersion = '3.8.0-stable'

dependencies
{
	// --- jMonkeyEngine Core ---
	implementation "org.jmonkeyengine:jme3-core:${jmeVersion}"
	implementation "org.jmonkeyengine:jme3-desktop:${jmeVersion}"
	implementation "org.jmonkeyengine:jme3-lwjgl3:${jmeVersion}"
	implementation "org.jmonkeyengine:jme3-effects:${jmeVersion}"
	implementation "org.jmonkeyengine:jme3-plugins:${jmeVersion}"

	// --- Lemur UI ---
	implementation 'com.simsilica:lemur:1.16.0'
	implementation 'com.simsilica:lemur-proto:1.13.0'

	// --- OpenSimplex2 noise is a single .java file dropped into src, no dependency needed. ---
}

// Make sure assets folder is available at runtime but not bundled in JAR.
sourceSets
{
	main
	{
		resources
		{
			// Only include properties files, etc. from resources, not assets.
			srcDirs 'src/main/resources'
		}
	}
}

// Handle duplicate files in resources.
processResources
{
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

// Configure JAR to be runnable (fat JAR with all dependencies).
jar
{
	manifest
	{
		attributes 'Main-Class': application.mainClass.get()
	}

	// Bundle all dependencies into the JAR for easy distribution.
	from
	{
		configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
	}

	// Exclude assets and bat file from being bundled in the JAR.
	exclude 'assets/**'
	exclude 'SimpleCraft.bat'
	
	duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

// JVM args for running.
run
{
	jvmArgs =
	[
		'--add-opens=java.base/java.lang=ALL-UNNAMED',
		'--add-opens=java.base/java.nio=ALL-UNNAMED',
		'--add-opens=java.base/sun.nio.ch=ALL-UNNAMED',
		'--add-opens=java.base/java.lang.reflect=ALL-UNNAMED'
	]
}

// Disable the default distribution tasks.
distZip
{
	enabled = false
}
distTar
{
	enabled = false
}
installDist
{
	enabled = false
}
startScripts
{
	enabled = false
}

// Create a custom distribution task.
task createCustomDist(type: Zip)
{
	archiveFileName = 'SimpleCraft.zip'
	destinationDirectory = file('build/distributions')
	
	// Include SimpleCraft.bat at the root.
	from('src/main/resources')
	{
		include 'SimpleCraft.bat'
	}
	
	// Include assets folder (not bundled in JAR).
	from('assets')
	{
		into 'assets'
	}
	
	// Include license and readme.
	from(rootDir)
	{
		include 'LICENSE.txt'
		include 'README.md'
	}
	
	// Include the fat JAR at the root.
	from(jar)
	{
		rename { 'SimpleCraft.jar' }
	}
}

// Make the custom task depend on the jar.
createCustomDist.dependsOn jar

// Override the assembleDist task to use our custom distribution.
assembleDist
{
	dependsOn createCustomDist
}

// Also override the build task to ensure our distribution is built.
build
{
	dependsOn createCustomDist
}
